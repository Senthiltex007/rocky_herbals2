<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Geniology Tree - Venkatesh</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

<style>
body { background: #f4f6f9; font-family: Arial, sans-serif; }
h2 { color: #004080; margin-bottom: 25px; }

/* Tree */
.tree { display: flex; justify-content: center; overflow-x: auto; padding-bottom: 40px; }
.tree ul { position: relative; padding-top: 20px; display: flex; justify-content: center; }
.tree ul::before { content: ""; position: absolute; top: 0; left: 50%; transform: translateX(-50%); border-left: 2px solid #6c6c6c; height: 20px; }
.tree li { list-style-type: none; text-align: center; position: relative; padding: 20px 10px 0 10px; }
.tree li::before, .tree li::after { content: ""; position: absolute; top: 0; width: 50%; height: 20px; border-top: 2px solid #6c6c6c; }
.tree li::before { left: -50%; border-right: 2px solid #6c6c6c; }
.tree li::after { right: -50%; border-left: 2px solid #6c6c6c; }
.tree li:only-child::before, .tree li:only-child::after { display: none; }
.tree li:first-child::before { border: none; }
.tree li:last-child::after { border: none; }

/* Member card */
.member-box { display: inline-block; background: #fff; border-radius: 12px; border: 2px solid #0d6efd; box-shadow: 0 4px 10px rgba(0,0,0,0.15); padding: 12px; width: 150px; cursor: pointer; transition: transform 0.3s, background 0.3s; }
.member-box:hover { transform: scale(1.05); background: #e8f0ff; }
.member-box small { font-weight: normal; color: #555; }

/* Add node icon */
.add-node { width: 40px; height: 40px; background-color: #28a745; border-radius: 50%; display: inline-block; position: relative; margin: 10px auto; cursor: pointer; box-shadow: 0 2px 6px rgba(0,0,0,0.2); }
.add-node::before, .add-node::after { content: ''; position: absolute; background-color: #fff; }
.add-node::before { top: 50%; left: 10px; width: 20px; height: 4px; transform: translateY(-50%); border-radius: 2px; }
.add-node::after { left: 50%; top: 10px; width: 4px; height: 20px; transform: translateX(-50%); border-radius: 2px; }

/* Overlay + Panel */
#overlayBackground, #addMemberOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; z-index: 999; }
#overlayBackground.show, #addMemberOverlay.show { display: block; }
#memberDetailPanel, #addMemberFormPanel { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 360px; background: #fff; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.3); display: none; z-index: 1000; max-height: 90vh; overflow-y: auto; }
#memberDetailPanel.show, #addMemberFormPanel.show { display: block; }

/* Popup branding and behavior */
#memberDetailPanel .card-header, #addMemberFormPanel .card-header { position: sticky; top: 0; background-color: #004080; color: #fff; font-weight: bold; z-index: 10; border-bottom: 1px solid #dee2e6; }
#memberDetailPanel .btn-close, #addMemberFormPanel .btn-close { filter: invert(1); }
#memberDetailPanel .card-body, #addMemberFormPanel .card-body { max-height: 70vh; overflow-y: auto; padding: 1rem; scroll-behavior: smooth; }
#memberDetailPanel .card-footer, #addMemberFormPanel .card-footer { background-color: #f8f9fa; color: #004080; font-weight: bold; text-align: center; padding: 0.5rem; border-top: 1px solid #dee2e6; }

@media (max-width: 576px) {
  #memberDetailPanel, #addMemberFormPanel { width: 95%; }
}
</style>
</head>
<body>

<h2 class="text-center mt-3">ðŸŒ³ Geniology Tree - Venkatesh ({{ root.auto_id }})</h2>

<div class="tree">
  <ul class="tree-root">
    {% include "member_node.html" with member=root %}
  </ul>
</div>

<div id="overlayBackground" onclick="hideMemberDetail()"></div>
<div id="memberDetailPanel" class="card shadow-lg">
  <div class="card-header d-flex justify-content-between align-items-center">
    <span>Member Statistics</span>
    <button type="button" class="btn-close" onclick="hideMemberDetail()"></button>
  </div>
  <div class="card-body">
    <p><strong>Member ID:</strong> <span id="panelMemberId"></span></p>
    <p><strong>Member Name:</strong> <span id="panelName"></span></p>
    <p><strong>Sponsor ID:</strong> <span id="panelSponsorId"></span></p>
    <p><strong>Mobile No:</strong> <span id="panelPhone"></span></p>
    <p><strong>Current Rank:</strong> <span id="panelRank"></span></p>
    <p><strong>Date of Joining:</strong> <span id="panelJoined"></span></p>
    <p><strong>Self BV:</strong> <span id="panelSelfBV"></span></p>
    <p><strong>Left Team BV:</strong> <span id="panelLeftBV"></span></p>
    <p><strong>Right Team BV:</strong> <span id="panelRightBV"></span></p>
    <p><strong>Total Team BV:</strong> <span id="panelTotalBV"></span></p>
    <div class="d-flex justify-content-between mt-3">
      <a id="editLink" class="btn btn-primary btn-sm">Edit</a>
      <a id="editSponsorLink" class="btn btn-warning btn-sm">Edit Sponsor</a>
      <a id="deleteLink" class="btn btn-danger btn-sm">Delete</a>
    </div>
  </div>
</div>

<!-- Add Member Overlay + Form (single source of truth) -->
<div id="addMemberOverlay" onclick="hideAddMemberForm()"></div>
<div id="addMemberFormPanel" class="card shadow-lg">
  <div class="card-header d-flex justify-content-between align-items-center">
    <span>Add New Member</span>
    <button type="button" class="btn-close" onclick="hideAddMemberForm()"></button>
  </div>
  <div class="card-body">
    <form method="POST" id="addMemberForm" action="">
      {% csrf_token %}
      <input type="hidden" name="parent_id" id="formParentId">
      <input type="hidden" name="position" id="formPosition">

      <div class="mb-2">
        <label class="form-label">Name</label>
        <input type="text" name="name" class="form-control" required>
      </div>
      <div class="mb-2">
        <label class="form-label">Mobile Number</label>
        <input type="text" name="phone" class="form-control" required>
      </div>
      <div class="mb-2">
        <label class="form-label">Aadhaar Number</label>
        <input type="text" name="aadhar" class="form-control" required>
      </div>
      <div class="mb-2">
        <label class="form-label">Auto ID</label>
        <input type="text" name="auto_id" class="form-control" id="formAutoId" readonly>
      </div>
      <button type="submit" class="btn btn-success w-100">Add Member</button>
    </form>
  </div>
</div>

<script>
function showMemberDetail(data) {
  document.getElementById("panelMemberId").innerText = data.auto_id;
  document.getElementById("panelName").innerText = data.name;
  document.getElementById("panelSponsorId").innerText = data.sponsor_id || "â€“";
  document.getElementById("panelPhone").innerText = data.phone || "â€“";
  document.getElementById("panelRank").innerText = data.rank || "Member";
  document.getElementById("panelJoined").innerText = data.joined_date || "â€“";
  document.getElementById("panelSelfBV").innerText = data.self_bv || "0";
  document.getElementById("panelLeftBV").innerText = data.left_bv || "0";
  document.getElementById("panelRightBV").innerText = data.right_bv || "0";
  document.getElementById("panelTotalBV").innerText = data.total_bv || "0";

  document.getElementById("editLink").href = "/member/edit/" + data.id + "/";
  document.getElementById("editSponsorLink").href = "/member/edit-sponsor/" + data.id + "/";
  document.getElementById("deleteLink").href = "/member/delete/" + data.id + "/";

  document.getElementById("overlayBackground").classList.add("show");
  document.getElementById("memberDetailPanel").classList.add("show");
}

function hideMemberDetail() {
  document.getElementById("overlayBackground").classList.remove("show");
  document.getElementById("memberDetailPanel").classList.remove("show");
}

function showAddMemberForm(parentId, position) {
  // set hidden fields
  document.getElementById("formParentId").value = parentId;
  document.getElementById("formPosition").value = position;

  // set form action to your view: /member/add/<parent_id>/<position>/
  const form = document.getElementById("addMemberForm");
  form.action = "/member/add/" + parentId + "/" + position + "/";

  // show a placeholder Auto ID (backend will overwrite)
  const newId = "rocky" + Date.now().toString().slice(-4);
  document.getElementById("formAutoId").value = newId;

  // show overlay
  document.getElementById("addMemberOverlay").classList.add("show");
  document.getElementById("addMemberFormPanel").classList.add("show");
}

function hideAddMemberForm() {
  document.getElementById("addMemberOverlay").classList.remove("show");
  document.getElementById("addMemberFormPanel").classList.remove("show");
}
</script>

</body>
</html>

/* Center popup vertically on all screen sizes */
#memberDetailPanel,
#addMemberFormPanel {
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);  /* âœ… center both horizontally and vertically */
    max-height: 90vh;                  /* âœ… prevent overflow on small screens */
    overflow-y: auto;                  /* âœ… scroll if content is taller than screen */
}

/* Responsive popup width for mobile screens */
@media (max-width: 576px) {
  #memberDetailPanel,
  #addMemberFormPanel {
    width: 95%;              /* âœ… shrink to fit small screens */
    max-height: 90vh;        /* âœ… prevent overflow */
    overflow-y: auto;        /* âœ… scroll if taller than screen */
  }
}
/* Keep popup header fixed while scrolling */
#memberDetailPanel .card-header,
#addMemberFormPanel .card-header {
    position: sticky;
    top: 0;
    background: #fff;       /* âœ… ensure header background stays solid */
    z-index: 10;            /* âœ… keep header above body content */
    border-bottom: 1px solid #dee2e6;
}
/* Smooth scrolling and padding inside popup body */
#memberDetailPanel .card-body,
#addMemberFormPanel .card-body {
    max-height: 70vh;       /* âœ… limit body height so header/footer stay visible */
    overflow-y: auto;       /* âœ… enable vertical scrolling */
    padding: 1rem;          /* âœ… consistent padding for readability */
    scroll-behavior: smooth;/* âœ… smooth scrolling effect */
}
/* Rocky Herbals branding color for popup headers */
#memberDetailPanel .card-header,
#addMemberFormPanel .card-header {
    background-color: #004080;   /* âœ… deep herbal blue branding */
    color: #fff;                 /* âœ… white text for contrast */
    font-weight: bold;
}
#memberDetailPanel .btn-close,
#addMemberFormPanel .btn-close {
    filter: invert(1);           /* âœ… make close button visible on dark header */
}
/* Branded footer styling */
#memberDetailPanel .card-footer,
#addMemberFormPanel .card-footer {
    background-color: #f8f9fa;   /* âœ… light gray for subtle contrast */
    color: #004080;              /* âœ… Rocky Herbals brand color */
    font-weight: bold;
    text-align: center;
    padding: 0.5rem;
    border-top: 1px solid #dee2e6;
}


{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-3 text-primary">ðŸŒ¿ Rocky Sri Herbals Dashboard</h2>
  <p class="lead">Welcome to Rocky Sri Herbals application home page.</p>

  <!-- Top Navigation Cards -->
  <div class="row mt-4">
    <!-- Member Tree Card -->
    <div class="col-md-3">
      <div class="card shadow-sm">
        <img src="{% static 'images/tree.png' %}" class="card-img-top" alt="Member Tree">
        <div class="card-body text-center">
          <h5 class="card-title">Member Tree</h5>
          <p class="card-text">View and manage your binary tree.</p>
          <a href="{% url 'member_tree_root' %}" class="btn btn-primary">View Tree</a>
        </div>
      </div>
    </div>

    <!-- Members List Card -->
    <div class="col-md-3">
      <div class="card shadow-sm">
        <img src="{% static 'images/members.png' %}" class="card-img-top" alt="Members">
        <div class="card-body text-center">
          <h5 class="card-title">Members</h5>
          <p class="card-text">Browse all registered members.</p>
          <a href="{% url 'member_list' %}" class="btn btn-info">Members List</a>
        </div>
      </div>
    </div>

    <!-- Products Card -->
    <div class="col-md-3">
      <div class="card shadow-sm">
        <img src="{% static 'images/products.png' %}" class="card-img-top" alt="Products">
        <div class="card-body text-center">
          <h5 class="card-title">Products</h5>
          <p class="card-text">Explore Rocky Sri Herbals products.</p>
          <a href="{% url 'products' %}" class="btn btn-success">View Products</a>
        </div>
      </div>
    </div>

    <!-- Income Report Card -->
    <div class="col-md-3">
      <div class="card shadow-sm">
        <img src="{% static 'images/income.png' %}" class="card-img-top" alt="Income">
        <div class="card-body text-center">
          <h5 class="card-title">Income</h5>
          <p class="card-text">View members income details.</p>
          <a href="{% url 'income_report' %}" class="btn btn-warning">Income Report</a>
        </div>
      </div>
    </div>
  </div>

  <!-- âœ… Products Section -->
  <div class="mt-5">
    <h4 class="text-success fw-bold">Products</h4>
    <div class="row">
      {% for product in products %}
        <div class="col-md-4">
          <div class="card shadow-sm mb-3">
            {% if product.image %}
              <img src="{{ product.image.url }}" class="card-img-top" alt="{{ product.name }}">
            {% endif %}
            <div class="card-body">
              <h5 class="card-title">{{ product.name }}</h5>
              <p class="card-text">{{ product.description }}</p>
              <p><strong>MRP:</strong> â‚¹{{ product.mrp }}</p>
              <p><strong>BV:</strong> {{ product.bv_value }}</p>
              <div class="form-group">
                <label>Product ID</label>
                <input type="text" class="form-control" value="{{ product.product_id }}" readonly>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  </div>

  <!-- Income Snapshot -->
  <div class="row mt-5">
    <h4 class="text-success fw-bold">Income Snapshot</h4>
    <div class="row g-3">
      <div class="col-md-2">
        <div class="card text-center shadow-sm">
          <div class="card-body">
            <h6 class="text-muted">Binary</h6>
            <h5 class="fw-bold text-success">â‚¹{{ member.calculate_full_income.binary_income }}</h5>
          </div>
        </div>
      </div>
      <div class="col-md-2">
        <div class="card text-center shadow-sm">
          <div class="card-body">
            <h6 class="text-muted">Flash</h6>
            <h5 class="fw-bold text-info">â‚¹{{ member.calculate_full_income.flash_bonus }}</h5>
          </div>
        </div>
      </div>
      <div class="col-md-2">
        <div class="card text-center shadow-sm">
          <div class="card-body">
            <h6 class="text-muted">Sponsor</h6>
            <h5 class="fw-bold text-warning">â‚¹{{ member.calculate_full_income.sponsor_income }}</h5>
          </div>
        </div>
      </div>
      <div class="col-md-2">
        <div class="card text-center shadow-sm">
          <div class="card-body">
            <h6 class="text-muted">Salary</h6>
            <h5 class="fw-bold text-danger">â‚¹{{ member.calculate_full_income.salary }}</h5>
          </div>
        </div>
      </div>
      <div class="col-md-2">
        <div class="card text-center shadow-sm">
          <div class="card-body">
            <h6 class="text-muted">Commission</h6>
            <h5 class="fw-bold text-primary">â‚¹{{ member.calculate_full_income.stock_commission }}</h5>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- BV Progress Bars -->
  <div class="mt-4">
    <h5 class="fw-bold">Business Volume (BV)</h5>
    <div class="mb-2">
      <span class="text-muted">Left BV</span>
      <div class="progress">
        <div class="progress-bar bg-success" role="progressbar"
             style="width: {{ member.get_bv_counts.0|floatformat:0 }}%">
          {{ member.get_bv_counts.0 }}
        </div>
      </div>
    </div>
    <div class="mb-2">
      <span class="text-muted">Right BV</span>
      <div class="progress">
        <div class="progress-bar bg-info" role="progressbar"
             style="width: {{ member.get_bv_counts.1|floatformat:0 }}%">
          {{ member.get_bv_counts.1 }}
        </div>
      </div>
    </div>
  </div>

  <!-- âœ…âœ…âœ… AVATAR TREE PREVIEW INSERTED HERE -->
  <div class="mt-5">
    <h4 class="fw-bold text-primary">Network Snapshot</h4>

    <div style="background:white; padding:15px; border-radius:10px; box-shadow:0 0 8px rgba(0,0,0,0.08);">
      <h5 style="margin-top:0;">
        {{ member.name }} ({{ member.member_id }})
        <a href="{% url 'member_tree_root' %}" style="float:right; font-size:13px;">View Full Tree Â»</a>
      </h5>

      <div class="tree" id="dashTreeContainer" style="width:100%; overflow-x:auto; text-align:center; margin-top:10px;">
        <ul class="tree-root" style="padding-top:10px; display:table; margin:auto;">
          {% include "dashboard_tree_box.html" with node=member level=0 %}
        </ul>
      </div>
    </div>
  </div>
  <!-- âœ…âœ…âœ… END OF AVATAR TREE PREVIEW -->

  <!-- Tree View -->
  <div class="mt-4">
    <h5 class="fw-bold">Geniology Tree</h5>
    <div class="accordion" id="mlmTree">
      <div class="accordion-item">
        <h2 class="accordion-header" id="headingOne">
          <button class="accordion-button" type="button" data-bs-toggle="collapse"
                  data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
            {{ member.name }} ({{ member.auto_id }})
          </button>
        </h2>
        <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne">
          <div class="accordion-body">
            <ul>
              {% if member.left_child %}
                <li>Left Child: {{ member.left_child.name }}</li>
              {% else %}
                <li>Left Child: None</li>
              {% endif %}
              {% if member.right_child %}
                <li>Right Child: {{ member.right_child.name }}</li>
              {% else %}
                <li>Right Child: None</li>
              {% endif %}
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>
{% endblock %}


{% load static %}
{# Compact node: shows only name + auto_id. Click opens detail panel with basic info only. #}
<div class="member-node-compact node {% if not member.parent %}root{% endif %}"
     onclick="(function(el){ const rect = el.getBoundingClientRect(); const data = {
       id: '{{ member.id }}',
       auto_id: '{{ member.auto_id|default:member.id }}',
       name: '{{ member.name|escapejs }}',
       joined_date: '{% if member.joined_date %}{{ member.joined_date|date:"Y-m-d" }}{% endif %}',
       phone: '{{ member.phone|default:"" }}',
       district: '{{ member.district|default:"" }}'
     }; showMemberDetail(data, rect); })(this);">

  <div class="card compact-card" style="padding:6px; border-radius:6px; min-width:140px; max-width:180px;">
    <div style="display:flex; align-items:center; gap:8px;">
      <img src="{% if member.avatar %}{{ member.avatar.url }}{% else %}{% static 'images/default_avatar.png' %}{% endif %}"
           alt="avatar" width="36" height="36" style="border-radius:50%; object-fit:cover;">
      <div style="text-align:left;">
        <div class="node-name" style="font-size:0.88rem; font-weight:600; color:#222;">{{ member.name|truncatechars:18 }}</div>
        <div class="node-id" style="font-size:0.75rem; color:#666; margin-top:2px;">{{ member.auto_id|default:member.id }}</div>
      </div>
    </div>
  </div>

  <div class="children" style="margin-top:6px; display:flex; gap:10px; justify-content:center;">
    <div style="flex:1; text-align:center;">
      {% if member.left_child %}
        {% include 'member_node.html' with member=member.left_child %}
      {% else %}
        <a href="{% url 'place_member' %}?parent_id={{ member.id }}&side=L" class="btn btn-success rounded-circle add-slot" title="Add Left">➕</a>
      {% endif %}
    </div>
    <div style="flex:1; text-align:center;">
      {% if member.right_child %}
        {% include 'member_node.html' with member=member.right_child %}
      {% else %}
        <a href="{% url 'place_member' %}?parent_id={{ member.id }}&side=R" class="btn btn-success rounded-circle add-slot" title="Add Right">➕</a>
      {% endif %}
    </div>
  </div>
</div>


<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ member.name }} - Genealogy Tree</title>

    <style>
        body { font-family: Arial, sans-serif; background:#f4f4f4; margin:0; }
        h2 { text-align:center; padding:15px; background:#0057b7; color:white; }

        .tree { width:100%; overflow-x:auto; text-align:center; margin-top:20px; }
        .tree ul { padding-top:20px; display:table; margin:auto; }
        .tree li { display:table-cell; text-align:center; padding:20px 5px; vertical-align:top; position:relative; }

        .tree li::before, .tree li::after {
            content:''; position:absolute; top:0; right:50%;
            border-top:1px solid #bbb; width:50%; height:20px;
        }
        .tree li::after { right:auto; left:50%; border-left:1px solid #bbb; }
        .tree li:only-child::before, .tree li:only-child::after { display:none; }

        .box {
            background:white; padding:12px; border-radius:10px; border:2px solid #999;
            cursor:pointer; min-width:150px; transition:.3s; position:relative;
            display:inline-block;
        }
        .box:hover { background:#dff1ff; transform:scale(1.06); }

        /* ✅ Rank Badge */
        .rank-badge {
            position:absolute; top:-10px; right:-10px;
            background:#ffcc00; color:black; padding:4px 8px;
            border-radius:6px; font-size:11px; font-weight:bold;
            border:1px solid #b38f00;
        }

        /* ✅ Rank Colors */
        .rank-GoldStar { border-color:#FFD700; }
        .rank-ShineSilver { border-color:#C0C0C0; }
        .rank-TripleStar { border-color:#CD7F32; }
        .rank-DiamondStar { border-color:#00C0FF; }
        .rank-PlatinumStar { border-color:#E5E4E2; }
        .rank-TopTier { border-color:#8A2BE2; }

        .add-btn {
            display:inline-block; margin-top:8px; padding:6px 10px;
            background:#e7ffe7; border:1px dashed #00b300; color:#008000;
            border-radius:6px; font-size:13px; text-decoration:none;
        }
        .add-btn:hover { background:#caffca; }

        @media(max-width:600px){
            .box { min-width:120px; font-size:12px; padding:8px; }
            .add-btn { font-size:11px; padding:5px 8px; }
            .tree li { padding:10px 2px; }
        }
    </style>
</head>

<body>

<h2>Genealogy Tree – {{ member.name }} (ID: {{ member.member_id }})</h2>

<!-- ✅ ZOOM CONTROLS -->
<div style="text-align:center; margin-top:10px;">
    <button onclick="zoomIn()" style="padding:5px 10px;">➕ Zoom In</button>
    <button onclick="zoomOut()" style="padding:5px 10px;">➖ Zoom Out</button>
</div>

<div class="tree" id="treeContainer">
    <ul class="tree-root">
        {% include "herbalapp/tree_box.html" with node=member %}
    </ul>
</div>

<!-- ✅ POPUP MODAL WITH AVATAR -->
<div id="memberModal" style="
    display:none; position:fixed; top:0; left:0; width:100%; height:100%;
    background:rgba(0,0,0,0.5); justify-content:center; align-items:center;
    z-index:9999;">

    <div style="
        background:white; padding:20px; width:320px; border-radius:12px;
        box-shadow:0 0 20px rgba(0,0,0,0.3); text-align:center;">

        <!-- ✅ Avatar -->
        <img id="mAvatar" src="/static/images/default-avatar.png"
             style="width:80px;height:80px;border-radius:50%;margin-bottom:10px;">

        <h3 id="mName"></h3>
        <p>ID: <span id="mID"></span></p>
        <p>Rank: <span id="mRank"></span></p>
        <p>Left BV: <span id="mLBV"></span></p>
        <p>Right BV: <span id="mRBV"></span></p>

        <a id="profileBtn" href="#"
           style="display:inline-block; margin-top:10px; padding:8px 15px;
           background:#0057b7; color:white; border-radius:6px; text-decoration:none;">
           View Profile
        </a>

        <br><br>

        <button onclick="closeModal()" style="
            padding:8px 15px; border:none; background:#999; color:white;
            border-radius:6px; cursor:pointer;">
            Close
        </button>
    </div>
</div>

<script>
function info(name, id, rank, lbv, rbv, avatarUrl=null){
    document.getElementById("mName").innerText = name;
    document.getElementById("mID").innerText = id;
    document.getElementById("mRank").innerText = rank;
    document.getElementById("mLBV").innerText = lbv;
    document.getElementById("mRBV").innerText = rbv;

    // ✅ Avatar support
    if (avatarUrl){
        document.getElementById("mAvatar").src = avatarUrl;
    } else {
        document.getElementById("mAvatar").src = "/static/images/default-avatar.png";
    }

    document.getElementById("profileBtn").href = "/member/detail/" + id + "/";
    document.getElementById("memberModal").style.display = "flex";
}

function closeModal(){
    document.getElementById("memberModal").style.display = "none";
}

let zoom = 1;

function zoomIn(){
    zoom += 0.1;
    document.getElementById("treeContainer").style.transform = "scale(" + zoom + ")";
}

function zoomOut(){
    zoom -= 0.1;
    document.getElementById("treeContainer").style.transform = "scale(" + zoom + ")";
}
</script>

</body>
</html>

